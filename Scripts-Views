-- ðŸ§  Etapa 2: Views Inteligentes

-- ðŸ” 1. vw_AlertaAlergia
-- Filtra avaliaÃ§Ãµes com palavras-chave suspeitas de reaÃ§Ã£o alÃ©rgica.

CREATE VIEW vw_AlertaAlergia AS
SELECT *
FROM Avaliacoes
WHERE Comentario LIKE '%alergia%'
   OR Comentario LIKE '%inchado%'
   OR Comentario LIKE '%reaÃ§Ã£o%';

SELECT * FROM vw_AlertaAlergia;

-- ðŸª 2. vw_EstoqueInconsistente
-- Mostra lojas que tÃªm estoque real, mas o sistema marca como â€œZeradoâ€.

CREATE VIEW vw_EstoqueInconsistente AS
SELECT *
FROM Estoque
WHERE QuantidadeEstoque > 0 AND StatusSistema = 'Zerado';

SELECT * FROM vw_EstoqueInconsistente;

-- ðŸ“‰ 3. vw_QuedaVendas
-- Agrupa vendas por dia e ordena da menor pra maior â€” pra detectar a queda.

CREATE VIEW vw_QuedaVendas AS
SELECT DataVenda, SUM(Quantidade) AS TotalVendido
FROM Vendas
GROUP BY DataVenda;

SELECT * FROM vw_QuedaVendas
ORDER BY TotalVendido ASC;

-- ðŸ“£ 4. vw_CampanhasSuspeitas
-- Filtra campanhas pausadas com ROI abaixo de 1.0 â€” sinal de problema.

CREATE VIEW vw_CampanhasSuspeitas AS
SELECT *
FROM CampanhasMarketing
WHERE ROI < 1.0 AND Status = 'Pausada';

SELECT * FROM vw_CampanhasSuspeitas;

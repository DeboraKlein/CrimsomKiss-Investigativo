-- üß® Etapa 4: Triggers e Alertas Inteligentes
-- ‚úÖ Trigger 1: Alerta de Avalia√ß√£o Ruim
-- Dispara quando uma avalia√ß√£o com nota ‚â§ 2 √© inserida. Pode registrar em uma tabela de alertas 
-- ou enviar notifica√ß√£o.

CREATE TRIGGER trg_AlertaAvaliacaoRuim
ON Avaliacoes
AFTER INSERT
AS
BEGIN
    IF EXISTS (
        SELECT 1 FROM inserted WHERE Nota <= 2
    )
    BEGIN
        PRINT '‚ö†Ô∏è Alerta: Avalia√ß√£o negativa registrada!'
        -- Aqui voc√™ pode inserir em uma tabela de log ou acionar outro processo
    END
END;

-- üîÑ Trigger 2: Atualiza√ß√£o de Status de Estoque
-- Atualiza o campo StatusEstoque automaticamente com base na Quantidade.

CREATE TRIGGER trg_AtualizaStatusEstoque
ON Estoque
AFTER INSERT, UPDATE
AS
BEGIN
    UPDATE E
    SET StatusEstoque = 
        CASE 
            WHEN E.Quantidade = 0 THEN 'Indispon√≠vel'
            WHEN E.Quantidade < 10 THEN 'Baixo'
            ELSE 'Dispon√≠vel'
        END
    FROM Estoque E
    JOIN inserted i ON E.IDEstoque = i.IDEstoque;
END;

